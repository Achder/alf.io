<div>
    <div class="panel panel-default" data-ng-repeat="subscription in $ctrl.subscriptions"
         data-ng-class="{'panel-danger':ticketCategory.containingOrphans, 'panel-warning':ticketCategory.containingStuckTickets}"
         id="subscription-{{subscription.id}}">
        <div class="panel-heading">
            <div class="panel-title">
                <div class="row">
                    <div class="col-xs-12 col-md-3">
                        <div class="category-name">
                            {{$ctrl.firstTranslation(subscription.title)}}
                        </div>
                    </div>
                    <div class="hidden-xs hidden-sm col-md-4">
                        <uib-progress ng-if="subscription.maxEntries > 0" max="subscription.maxEntries" tooltip-popup-close-delay="500">
                            <uib-bar value="ticketCategory.checkedInTickets" type="success"><span>{{ticketCategory.checkedInTickets}}</span></uib-bar>
                            <uib-bar value="ticketCategory.soldTickets" type="warning"><span>{{ticketCategory.soldTickets}}</span></uib-bar>
                            <uib-bar value="ticketCategory.pendingTickets" type="info" class="slice-pending">{{ticketCategory.pendingTickets}}</uib-bar>
                            <uib-bar value="ticketCategory.notSoldTickets" type="info">{{ticketCategory.notSoldTickets}}</uib-bar>
                            <uib-bar ng-if="!ticketCategory.bounded" value="event.dynamicAllocation" type="default">{{event.dynamicAllocation}}</uib-bar>
                        </uib-progress>
                    </div>
                    <div class="col-xs-12 col-md-5">
                        <div class="pull-right">
                            <a class="btn btn-sm btn-default" ui-sref="events.single.ticketsList({eventName: event.shortName, categoryId: ticketCategory.id})">
                                <i class="fa fa-ticket"></i> Linked Events
                            </a>
                            <a class="btn btn-sm btn-danger" ng-if="canBeDeleted(ticketCategory)" ng-click="deleteCategory(ticketCategory, event)"><i class="fa fa-trash"></i> delete</a>
                        </div>
                    </div>
                </div>

            </div>
        </div>
        <div class="panel-body">
            <div class="row">
                <div class="col-xs-12 col-md-5">
                    <h5><i class="fa fa-calendar-check-o fa-1_5x"></i> <span class="sr-only">Sale period</span>
                        <span class="text-muted">
                            <span ng-if="$ctrl.ticketCategory.formattedInception">{{$ctrl.ticketCategory.formattedInception | formatDate}}</span>
                            <span ng-if="!$ctrl.ticketCategory.formattedInception">{{$ctrl.formatDateTimeModification($ctrl.ticketCategory.inception) | formatDate}}</span> -
                            <span ng-if="$ctrl.ticketCategory.formattedExpiration">{{$ctrl.ticketCategory.formattedExpiration | formatDate}}</span>
                            <span ng-if="!$ctrl.ticketCategory.formattedExpiration">{{$ctrl.formatDateTimeModification($ctrl.ticketCategory.expiration) | formatDate}}</span>
                        </span>
                    </h5>
                    <h5>
                        <i class="fa fa-ticket fa-1_5x"></i><span class="sr-only">Max Tickets</span>
                        <span class="text-muted" ng-switch="$ctrl.ticketCategory.bounded">
                <span ng-switch-when="true">{{$ctrl.ticketCategory.maxTickets}}</span>
                <span ng-switch-when="false">dynamic</span>
            </span>
                        <i class="ml-1 fa fa fa-money fa-1_5x" ng-if="!$ctrl.event.freeOfCharge"></i><span class="sr-only">Ticket Price</span>
                        <span class="text-muted" ng-if="!$ctrl.event.freeOfCharge">
                {{$ctrl.ticketCategory.price | money : ($ctrl.event.currency || "")}} <span ng-if="!$ctrl.event.vatIncluded"><i class="text-muted">+ VAT</i></span>
            </span>
                    </h5>
                    <h5 ng-if="$ctrl.hasCustomCheckIn()">
                        <i class="fa fa-qrcode fa-1_5x"></i><span class="sr-only">Check-in Interval</span>
                        <span class="text-muted">{{$ctrl.getCheckInFrom() | formatDate}} - {{$ctrl.getCheckInTo() | formatDate}}</span>
                    </h5>
                    <h5 ng-if="$ctrl.hasCustomTicketValidity()">
                        <i class="fa fa-clock-o fa-1_5x"></i><span class="sr-only">Ticket Validity</span>
                        <span class="text-muted">{{$ctrl.getTicketValidityFrom() | formatDate}} - {{$ctrl.getTicketValidityTo() | formatDate}}</span>
                    </h5>
                    <small class="text-muted">ID: {{subscription.id}}</small>
                </div>
                <div class="col-md-7 category-detail hidden-xs">
                    <uib-tabset>
                        <uib-tab heading="{{lang}}" data-ng-repeat="(lang, desc) in subscription.description">
                            <div style="position: absolute; right: 15px; margin-top: 5px;"><display-commonmark-preview text="desc"></display-commonmark-preview></div>
                            <pre class="white text-muted">{{desc}}</pre>
                        </uib-tab>
                    </uib-tabset>
                </div>
            </div>
        </div>
        <div>
            <hr>
            <div class="row">
                <div class="col-md-2 col-md-push-10 col-xs-12">
                    <a type="button" class="btn btn-warning btn-block" ui-sref="^.edit({ organizationId: subscription.organizationId, subscriptionId: subscription.id})" >Edit</a>
                </div>
            </div>
        </div>
    </div>
</div>
<a class="btn btn-success pull-right" ui-sref="^.new({organizationId: $ctrl.organizationId})"><i class="fa fa-plus"></i> add new</a>